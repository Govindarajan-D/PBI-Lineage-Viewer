<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cytoscape Graph</title>
    <script src="https://unpkg.com/cytoscape@3.30.0/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.js"></script>
    <script src="https://unpkg.com/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>
    <style>
        body { 
        font: 14px helvetica neue, helvetica, arial, sans-serif;
        }

        #cy {
        height: 100%;
        width: 100%;
        position: absolute;
        left: 0;
        top: 0;
        }
    </style>
</head>
<body>
    <div id="cy"></div>
    <script>
        document.addEventListener('DOMContentLoaded', function() { // on dom ready

        var cy = cytoscape({
            container: document.querySelector('#cy'),

            layout: {
                name: 'dagre',
                rankDir: 'LR',
                minZoom: 1
            },

            style: [
            {
              selector: 'node',
              style: {
                    'shape': 'data(faveShape)',
                    'width': 'mapData(weight, 40, 80, 20, 60)',
                    'content': 'data(name)',
                    'text-valign': 'center',
                    'text-outline-width': 2,
                    'text-outline-color': 'data(faveColor)',
                    'background-color': 'data(faveColor)',
                    'color': '#fff'
              }
            },
            {
              selector: 'edge',
              style: {
                'curve-style': 'bezier',
                'opacity': 0.666,
                'width': 'mapData(strength, 70, 100, 2, 6)',
                'target-arrow-shape': 'triangle',
                'source-arrow-shape': 'circle',
                'line-color': 'data(faveColor)',
                'source-arrow-color': 'data(faveColor)',
                'target-arrow-color': 'data(faveColor)'
              }
            },
            {
              selector: ':selected',
              style: {
                'curve-style': 'bezier',
                'opacity': 1,
                'width': 'mapData(strength, 70, 100, 2, 6)',
                'target-arrow-shape': 'triangle',
                'source-arrow-shape': 'circle',
                'line-color': 'black',
                'source-arrow-color': 'data(faveColor)',
                'target-arrow-color': 'data(faveColor)'
              }
            },
            {
                selector: 'edge.questionable',
                style:{
                    'line-style': 'dotted',
                    'target-arrow-shape': 'diamond'
                }
            },
            {
                selector: '.faded',
                style: {
                    'opacity': 0.25
                }
            }
          ],
            elements: {
                nodes: [
                    { data: { id: 'a', name: 'Activation', weight: 50, faveColor: '#6FB1FC', faveShape: 'rectangle' } },
                    { data: { id: 'b', name: 'User Profile', weight: 45, faveColor: '#EDA1ED', faveShape: 'rectangle' } },
                    { data: { id: 'c', name: 'Billing', weight: 75, faveColor: '#86B342', faveShape: 'rectangle' } },
                    { data: { id: 'd', name: 'Sales', weight: 70, faveColor: '#F5A45D', faveShape: 'rectangle' } },
                    { data: { id: 'e', name: 'Device', weight: 70, faveColor: '#F5A45D', faveShape: 'rectangle' } },
                    { data: { id: 'f', name: 'Loan', weight: 70, faveColor: '#F5A45D', faveShape: 'rectangle' } },
                    { data: { id: 'j', name: 'Support', weight: 70, faveColor: '#F5A45D', faveShape: 'rectangle' } },
                    { data: { id: 'k', name: 'Sink Event', weight: 70, faveColor: '#F5A45D', faveShape: 'rectangle' } }
                ],
                edges: [
                    { data: { source: 'a', target: 'b', faveColor: '#6FB1FC', strength: 90 } },
                    { data: { source: 'b', target: 'c', faveColor: '#6FB1FC', strength: 70 } },
                    { data: { source: 'c', target: 'd', faveColor: '#6FB1FC', strength: 80 } },
                    { data: { source: 'c', target: 'e', faveColor: '#EDA1ED', strength: 95 } },
                    { data: { source: 'c', target: 'f', faveColor: '#EDA1ED', strength: 60 }, classes: 'questionable' },

                    { data: { source: 'd', target: 'j', faveColor: '#86B342', strength: 100 } },
                    { data: { source: 'e', target: 'j', faveColor: '#86B342', strength: 100 } }
                ]
            }
        });

        cy.on('tap', 'node', function (e) {
            var node = e.target; // Get the tapped node
            var OutgoingNodes = node.successors(); // Get edges connected to the node
            var IncomingNodes = node.predecessors(); // Get nodes connected by those edges
            console.log(OutgoingNodes);
            cy.elements().addClass('faded'); // Dim all elements
            OutgoingNodes.removeClass('faded'); // Highlight the node and its connected nodes
            IncomingNodes.removeClass('faded');
            node.removeClass('faded');
        });

        cy.on('tap', function(e) {
            if (e.target === cy) {
                cy.elements().removeClass('faded');
            }
        });

        }); // on dom ready
    </script>
</body>
</html>
